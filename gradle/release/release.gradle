apply from: "${rootDir}/gradle/release/package.gradle"
apply from: "${rootDir}/gradle/release/innosetup.gradle"
apply from: "${rootDir}/gradle/release/windows.gradle"

task('downloadAndExtractJREs', group: 'custom jre') {
    dependsOn downloadAndExtractWindowsJRE
}

downloadLicenses {
    dependencyConfiguration = 'compileClasspath'
    includeProjectDependencies = true
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

distributions {
    windows {
        setDistributionBaseName "${project.name}-windows-x64"
        contents {
            with distributions.main.contents
            from("build/reports")
            from("build/bin/eye-try.bat") {
                into 'bin'
            }
            from("build/jre/windows-x64") {
                into 'lib/jre'
            }
        }
    }
}

windowsDistZip.dependsOn(downloadAndExtractWindowsJRE)

tasks.withType(Tar){
    compression = Compression.GZIP
    archiveExtension.set('tar.gz')
}

distZip {
    duplicatesStrategy = 'exclude'
    //enabled = false
}
[bootJar, bootDistTar, bootDistZip]*.enabled = false

release {
    failOnPublishNeeded = false
    failOnCommitNeeded = false
}

startScripts.enabled = false

afterReleaseBuild.dependsOn generateWindowsInstallerInDocker
